# ๐ก๏ธ Server Security Script

ะะฝัะตัะฐะบัะธะฒะฝัะน ัะบัะธะฟั ะดะปั ะฑััััะพะน ะฝะฐัััะพะนะบะธ ะฑะฐะทะพะฒะพะน ะทะฐัะธัั Linux-ัะตัะฒะตัะฐ.

```bash
./fix_security.sh          # ะะฐัััะพะนะบะฐ ะฑะตะทะพะฟะฐัะฝะพััะธ
./fix_security.sh --restore # ะะพัััะฐะฝะพะฒะปะตะฝะธะต ะธะท ะฑัะบะฐะฟะฐ
```

## ะงัะพ ะทะฐัะธัะฐะตั

| ะฃะณัะพะทะฐ | ะะตัะตะฝะธะต |
|--------|---------|
| ะััััะพัั SSH | fail2ban + rate limiting |
| ะัะพะด ะฟะพ ัะปะฐะฑะพะผั ะฟะฐัะพะปั | ะขะพะปัะบะพ SSH-ะบะปััะธ |
| ะัะบััััะต ะฟะพััั | ะคะฐะนัะฒะพะป ั whitelist |
| ะัะฐะบะฐ ะฝะฐ root | ะะฐะฟัะตั ะฒัะพะดะฐ ะฟะพ ะฟะฐัะพะปั |
| ะัะบัััะฐั ะะ | PostgreSQL ัะพะปัะบะพ localhost |

## ะะพะทะผะพะถะฝะพััะธ

- โ **ะะธะฐะณะฝะพััะธะบะฐ ัะธััะตะผั** โ ัะบะฐะฝะธััะตั ะฟะพััั, ะพะฟัะตะดะตะปัะตั ัะตัะฒะธัั, ะฐะฝะฐะปะธะทะธััะตั SSH
- โ **SSH hardening** โ ะพัะบะปััะตะฝะธะต ะฟะฐัะพะปะตะน, ัะพะปัะบะพ ะบะปััะธ
- โ **fail2ban** โ ะฐะฒัะพะผะฐัะธัะตัะบะฐั ะฑะปะพะบะธัะพะฒะบะฐ ะฟะพัะปะต ะฝะตัะดะฐัะฝัั ะฟะพะฟััะพะบ
- โ **ะคะฐะนัะฒะพะป** โ iptables ะธะปะธ ufw ะฝะฐ ะฒัะฑะพั
- โ **Docker-safe** โ ะฝะต ะปะพะผะฐะตั FORWARD chain
- โ **ะัะบะฐะฟั** โ ะฐะฒัะพะผะฐัะธัะตัะบะพะต ัะตะทะตัะฒะฝะพะต ะบะพะฟะธัะพะฒะฐะฝะธะต
- โ **ะัะบะฐั** โ ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต ะพะดะฝะพะน ะบะพะผะฐะฝะดะพะน

## ะขัะตะฑะพะฒะฐะฝะธั

- **ะะก:** Ubuntu 18.04+ / Debian 9+
- **ะัะฐะฒะฐ:** root
- **ะฃัะธะปะธัั:** `ss`, `systemctl` (ะพะฑััะฝะพ ะฟัะตะดัััะฐะฝะพะฒะปะตะฝั)

## ะฃััะฐะฝะพะฒะบะฐ ะธ ะทะฐะฟััะบ

```bash
# ะกะบะฐัะฐัั ะธ ะทะฐะฟัััะธัั ะพะดะฝะพะน ะบะพะผะฐะฝะดะพะน
curl -fsSL https://raw.githubusercontent.com/Alex01010101010101/server-basic-security/main/fix_security.sh | sudo bash
```

## ะะฐะบ ัะฐะฑะพัะฐะตั

### ะญัะฐะฟ 1: ะะธะฐะณะฝะพััะธะบะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  ะะะะะะะกะขะะะ ะกะะกะขะะะซ ะะะะะะะกะะะกะขะ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

[โ] ะะก: Ubuntu 24.04.1 LTS
[โ] fail2ban: ัััะฐะฝะพะฒะปะตะฝ, ะฐะบัะธะฒะตะฝ
[i] ufw: ัััะฐะฝะพะฒะปะตะฝ, ะฝะต ะฐะบัะธะฒะตะฝ
[i] iptables: ัััะฐะฝะพะฒะปะตะฝ, ะตััั ะฟัะฐะฒะธะปะฐ (13)
โ๏ธ  Docker: ะะะขะะะะ
         ะกะบัะธะฟั ะะ ะฑัะดะตั ะธะทะผะตะฝััั FORWARD chain
         Docker ัะฐะผ ัะฟัะฐะฒะปัะตั ััะฐัะธะบะพะผ ะบะพะฝัะตะนะฝะตัะพะฒ

ะัะบััััะต ะฟะพััั (ะฒะฝะตัะฝะธะต ะธะฝัะตััะตะนัั):
  22/tcp    - SSH
  80/tcp    - HTTP
  443/tcp   - HTTPS
  3001/tcp  - python
  5432/tcp  - PostgreSQL

SSH ะบะพะฝัะธะณััะฐัะธั:
  Port: 22
[โ] PermitRootLogin: ะฝะฐัััะพะตะฝ ะฑะตะทะพะฟะฐัะฝะพ
[โ] PasswordAuthentication: ะพัะบะปััะตะฝะพ
[โ] SSH-ะบะปััะธ: ะฝะฐะนะดะตะฝั ะดะปั root
```

### ะญัะฐะฟ 2: ะะฝัะตัะฐะบัะธะฒะฝะฐั ะฝะฐัััะพะนะบะฐ

ะกะบัะธะฟั ะฟัะพัะพะดะธั ะฟะพ 5 ัะฐะทะดะตะปะฐะผ:

| ะะฐะทะดะตะป | ะงัะพ ะฝะฐัััะฐะธะฒะฐะตั |
|--------|-----------------|
| **[1/5] SSH** | ะัะบะปััะตะฝะธะต ะฟะฐัะพะปะตะน, ะทะฐะฟัะตั root ะฟะพ ะฟะฐัะพะปั |
| **[2/5] fail2ban** | ะฃััะฐะฝะพะฒะบะฐ/ะพะฑะฝะพะฒะปะตะฝะธะต ั ะฟะพะบะฐะทะพะผ ะฝะฐัััะพะตะบ |
| **[3/5] ะคะฐะนัะฒะพะป** | ะัะฑะพั iptables/ufw/ะฟัะพะฟัััะธัั |
| **[4/5] ะะพััั** | ะะปั ะบะฐะถะดะพะณะพ ะฟะพััะฐ: ัะฐะทัะตัะธัั? (y/n) |
| **[5/5] PostgreSQL** | ะขะพะปัะบะพ localhost ะธะปะธ ะฒะฝะตัะฝะธะน ะดะพัััะฟ |

### ะญัะฐะฟ 3: ะะพะดัะฒะตัะถะดะตะฝะธะต

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  ะะะะขะะะะะะะะะ ะะะะะะะะะ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ะัะดัั ะฟัะธะผะตะฝะตะฝั ัะปะตะดัััะธะต ะธะทะผะตะฝะตะฝะธั:

ะคะฐะนัะฒะพะป (iptables):
  [โ] ะะฐะทัะตัะธัั: SSH (22)
  [โ] ะะฐะทัะตัะธัั: HTTP (80)
  [โ] ะะฐะทัะตัะธัั: HTTPS (443)
  [โ] PostgreSQL (5432): ัะพะปัะบะพ localhost
  [i] Docker: FORWARD chain ะะ ะธะทะผะตะฝัะตััั
  [โ] ะะปะพะบะธัะพะฒะฐัั ะฒัะต ะพััะฐะปัะฝัะต ะฟะพััั

โ๏ธ  ะะะะะ: ะะตัะตะด ะฟัะธะผะตะฝะตะฝะธะตะผ ะฑัะดัั ัะพะทะดะฐะฝั ัะตะทะตัะฒะฝัะต ะบะพะฟะธะธ

ะัะธะผะตะฝะธัั ะธะทะผะตะฝะตะฝะธั? (y/n):
```

### ะญัะฐะฟ 4: ะัะธะผะตะฝะตะฝะธะต

- ะกะพะทะดะฐัั ะฑัะบะฐะฟั ะฒ `/root/backups/`
- ะัะธะผะตะฝัะตั ะธะทะผะตะฝะตะฝะธั
- ะัะพะฒะตััะตั SSH ะบะพะฝัะธะณ ะฟะตัะตะด ะฟะตัะตะทะฐะฟััะบะพะผ
- ะกะพััะฐะฝัะตั ะฟัะฐะฒะธะปะฐ ัะฐะนัะฒะพะปะฐ

## ะะฐัััะพะนะบะธ fail2ban

ะัะธ ัััะฐะฝะพะฒะบะต/ะพะฑะฝะพะฒะปะตะฝะธะธ ะฟัะธะผะตะฝััััั:

| ะะฐัะฐะผะตัั | ะะฝะฐัะตะฝะธะต | ะะฟะธัะฐะฝะธะต |
|----------|----------|----------|
| bantime (ะพะฑัะธะน) | 3600 ัะตะบ | ะะปะพะบะธัะพะฒะบะฐ ะฝะฐ 1 ัะฐั |
| findtime | 600 ัะตะบ | ะะบะฝะพ ะฐะฝะฐะปะธะทะฐ 10 ะผะธะฝัั |
| maxretry (ะพะฑัะธะน) | 5 | ะะพะฟััะพะบ ะดะพ ะฑะปะพะบะธัะพะฒะบะธ |
| **SSH maxretry** | **3** | ะะปั SSH ัััะพะถะต |
| **SSH bantime** | **7200 ัะตะบ** | SSH ะฑะฐะฝ ะฝะฐ 2 ัะฐัะฐ |

## ะะตะทะตัะฒะฝัะต ะบะพะฟะธะธ

ะัะต ะฑัะบะฐะฟั ัะพััะฐะฝััััั ะฒ `/root/backups/`:

```
/root/backups/
โโโ sshd_config.backup.20251203_174722
โโโ iptables_backup_20251203_174722.rules
โโโ fail2ban_jail.local.backup.20251203_174722
```

## ะะพัััะฐะฝะพะฒะปะตะฝะธะต

### ะงะตัะตะท ัะบัะธะฟั (ัะตะบะพะผะตะฝะดัะตััั)

```bash
./fix_security.sh --restore
```

ะะพะบะฐะถะตั ะผะตะฝั ัะพ ะฒัะตะผะธ ะฑัะบะฐะฟะฐะผะธ ะธ ะฒะพัััะฐะฝะพะฒะธั ะฒัะฑัะฐะฝะฝัะน.

### ะัััะฝัั

```bash
# SSH
cp /root/backups/sshd_config.backup.* /etc/ssh/sshd_config
systemctl restart sshd

# iptables
iptables-restore < /root/backups/iptables_backup_*.rules

# fail2ban
cp /root/backups/fail2ban_jail.local.backup.* /etc/fail2ban/jail.local
systemctl restart fail2ban
```

## ะะพะปะตะทะฝัะต ะบะพะผะฐะฝะดั

### fail2ban

```bash
# ะกัะฐััั ะธ ะทะฐะฑะปะพะบะธัะพะฒะฐะฝะฝัะต IP
fail2ban-client status sshd

# ะะฐะทะฑะปะพะบะธัะพะฒะฐัั IP
fail2ban-client set sshd unbanip 192.168.1.100
```

### ะคะฐะนัะฒะพะป

```bash
# iptables โ ะฟัะพัะผะพัั ะฟัะฐะฒะธะป
iptables -L INPUT -n -v --line-numbers

# ufw โ ะฟัะพัะผะพัั ะฟัะฐะฒะธะป
ufw status verbose
```

## Docker ะธ FORWARD chain

โ๏ธ **ะะฐะถะฝะพ:** ะกะบัะธะฟั **ะะ ััะพะณะฐะตั FORWARD chain**, ะตัะปะธ ะพะฑะฝะฐััะถะตะฝ Docker.

Docker ัะฐะผ ัะฟัะฐะฒะปัะตั:
- ะะทะพะปััะธะตะน ะบะพะฝัะตะนะฝะตัะพะฒ (`DOCKER-ISOLATION`)
- ะขัะฐัะธะบะพะผ ะผะตะถะดั ะบะพะฝัะตะนะฝะตัะฐะผะธ (`DOCKER-FORWARD`)
- NAT ะดะปั port mapping

ะกะบัะธะฟั ะฝะฐัััะฐะธะฒะฐะตั ัะพะปัะบะพ **INPUT chain** โ ะฒัะพะดััะธะน ััะฐัะธะบ ะฝะฐ ัะฐะผ ัะตัะฒะตั.

## ะะตะทะพะฟะฐัะฝะพััั

### โ๏ธ ะะตัะตะด ะทะฐะฟััะบะพะผ

1. **SSH-ะบะปััะธ** โ ัะฑะตะดะธัะตัั, ััะพ ะผะพะถะตัะต ะฒะพะนัะธ ะฟะพ ะบะปััั:
   ```bash
   # ะะฐ ะปะพะบะฐะปัะฝะพะน ะผะฐัะธะฝะต
   ssh-copy-id root@your-server
   ```

2. **ะขะตััะพะฒะพะต ะฟะพะดะบะปััะตะฝะธะต** โ ะพัะบัะพะนัะต ะฒัะพัะพะน ัะตัะผะธะฝะฐะป ั SSH ะดะพ ะฟัะธะผะตะฝะตะฝะธั ะธะทะผะตะฝะตะฝะธะน

3. **ะัะบะฐะฟ ัะตัะฒะตัะฐ** โ ะฝะฐ ะฒััะบะธะน ัะปััะฐะน ัะดะตะปะฐะนัะต ัะฝะฐะฟัะพั VPS

### ะงัะพ ัะบัะธะฟั ะฟัะพะฒะตััะตั

- โ ะะฐะปะธัะธะต SSH-ะบะปััะตะน ะฟะตัะตะด ะพัะบะปััะตะฝะธะตะผ ะฟะฐัะพะปะตะน
- โ ะะฐะปะธะดะฝะพััั SSH ะบะพะฝัะธะณะฐ (`sshd -t`) ะฟะตัะตะด ะฟะตัะตะทะฐะฟััะบะพะผ
- โ ะะต ััะพะณะฐะตั Docker ะตัะปะธ ะพะฝ ะฐะบัะธะฒะตะฝ

## ะะณัะฐะฝะธัะตะฝะธั

ะกะบัะธะฟั ะพะฑะตัะฟะตัะธะฒะฐะตั **ะฑะฐะทะพะฒัั** ะทะฐัะธัั. ะะต ะฒะบะปััะฐะตั:

- ะะฒัะพะผะฐัะธัะตัะบะธะต ะพะฑะฝะพะฒะปะตะฝะธั (`unattended-upgrades`)
- ะัะดะธั ะธ ะผะพะฝะธัะพัะธะฝะณ (auditd, AIDE)
- Hardening ัะดัะฐ (sysctl)
- 2FA ะดะปั SSH
- IPv6 ัะฐะนัะฒะพะป
- WAF ะดะปั ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธะน

ะะปั ัะตัััะทะฝะพะน ะทะฐัะธัั (PCI DSS, HIPAA) ััะตะฑััััั ะดะพะฟะพะปะฝะธัะตะปัะฝัะต ะผะตัั.

## ะฃัััะฐะฝะตะฝะธะต ะฝะตะฟะพะปะฐะดะพะบ

### ะะพัะตััะป ะดะพัััะฟ ะฟะพ SSH

1. ะะพะดะบะปััะธัะตัั ัะตัะตะท ะบะพะฝัะพะปั VPS-ะฟัะพะฒะฐะนะดะตัะฐ
2. ะะพัััะฐะฝะพะฒะธัะต ะบะพะฝัะธะณ:
   ```bash
   cp /root/backups/sshd_config.backup.* /etc/ssh/sshd_config
   systemctl restart sshd
   ```

### ะกะบัะธะฟั ะฝะต ะพะฟัะตะดะตะปัะตั ัะตัะฒะธัั

```bash
apt install iproute2 lsof
```

### Docker ะฟะตัะตััะฐะป ัะฐะฑะพัะฐัั

ะัะปะธ ัะปััะฐะนะฝะพ ะทะฐััะพะฝัะปะธ FORWARD:
```bash
systemctl restart docker
```
Docker ะฟะตัะตัะพะทะดะฐัั ัะฒะพะธ ะฟัะฐะฒะธะปะฐ.

## ะะตััะธั

**1.0.0**
